<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>JLT 2025 现场扫码签到</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>
  :root{--bg:#004d40;--primary:#26a69a;--text:#fff;}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);
            display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;}
  img.logo{max-width:80vw;margin-bottom:20px;}
  h1{font-size:2.3rem;margin:10px 0 30px;font-weight:700;letter-spacing:.05em;}
  button.scan-btn{background:var(--primary);border:none;color:#fff;font-size:1.5rem;padding:20px 60px;border-radius:12px}
  #video{width:100%;max-width:400px;border-radius:12px;display:none}
</style>
</head>
<body>
  <img class="logo" src="https://www.torontostm.com/wp-content/uploads/2016/12/TSTM-Logo-with-slogan-768x121.png" alt="TSTM Logo">
  <h1>JLT 2025 現場掃描Sign-In</h1>

  <!-- 开始按钮 -->
  <button class="scan-btn" id="startBtn">開始掃描</button>

  <!-- 视频预览 -->
  <video id="video" playsinline></video>

  <!-- jsQR 库 -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

  <script>
  const startBtn = document.getElementById('startBtn');
  const video    = document.getElementById('video');
  const canvas   = document.createElement('canvas');
  const ctx      = canvas.getContext('2d');
  let scanning   = false;

  startBtn.onclick = startScan;

  async function startScan() {
    startBtn.style.display = 'none';
    video.style.display = 'block';
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: 'environment' }
    });
    video.srcObject = stream;
    video.onloadedmetadata = () => {
      video.play();
      scanning = true;
      tick();
    };
  }

  function tick() {
    if (!scanning) return;
    if (video.readyState === video.HAVE_ENOUGH_DATA) {
      canvas.height = video.videoHeight;
      canvas.width  = video.videoWidth;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const code = jsQR(imageData.data, imageData.width, imageData.height);
      if (code) {
        scanning = false;
        video.srcObject.getTracks().forEach(t => t.stop());
        alert('QR 内容：\n' + code.data);   // 这里你可以换成自己的后续流程
        location.reload();                 // 回到首页
      }
    }
    requestAnimationFrame(tick);
  }
  </script>
</body>
</html>
